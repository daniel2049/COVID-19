<!DOCTYPE html>
<html>
<head>
<style>
table#t01 td {
  table-layout: fixed;
  border: 1px solid black;
}
div#d01 {
    display: flex;
    flex-flow: row-reverse;
    align-items: center;
    justify-content: flex-end;
    height: 30px;
}
.lblFloat
{
    float:right;
    text-align: center;
    padding-left: 1em;
}
H2 {
    margin: 0px;
}
</style>
</head>
<body>

<H2 align="center">COVID-19 Cases in U.S.</H2>
<object id="svg-object" type="image/svg+xml" data="USA_Counties_with_FIPS_and_names.svg" ></object>
<br>
<input type="radio" id="map_us" name="us_region" onclick="resize_map('svg-object')">
<label for="map_us">United States</label>
<input type="radio" id="map_w" name="us_region" onclick="resize_map('svg-object')">
<label for="map_w">Pacific West</label>
<input type="radio" id="map_wm" name="us_region" onclick="resize_map('svg-object')">
<label for="map_wm">Mountain States</label>
<input type="radio" id="map_nc" name="us_region" onclick="resize_map('svg-object')">
<label for="map_nc">North Central</label>
<input type="radio" id="map_ne" name="us_region" onclick="resize_map('svg-object')">
<label for="map_ne">North East</label>
<input type="radio" id="map_se" name="us_region" onclick="resize_map('svg-object')">
<label for="map_se">South East</label>
<input type="radio" id="map_sc" name="us_region" onclick="resize_map('svg-object')">
<label for="map_sc">South Central</label>
<input type="radio" id="map_hi" name="us_region" onclick="resize_map('svg-object')">
<label for="map_hi">Hawaii</label>

    <script type="text/javascript" src="cases.js"></script>
    <script type="text/javascript">
      function resize_map(id) {
        var D=document.getElementById(id)
	S=eval(D.nodeName)(D,id) //sends OBJECT to function OBJECT, EMBED to EMBED etc.
	if (!S) return

        e = S.getElementById('svg9559');
        if (document.getElementById("map_us").checked) {
           e.setAttribute("viewBox", "0 0 555 352");
        } else if (document.getElementById("map_w").checked) {
           e.setAttribute("viewBox", "0 0 185 225");
        } else if (document.getElementById("map_wm").checked) {
           e.setAttribute("viewBox", "0 13 285 241");
        } else if (document.getElementById("map_nc").checked) {
           e.setAttribute("viewBox", "185 30 270 170");
        } else if (document.getElementById("map_ne").checked) {
           e.setAttribute("viewBox", "350 40 200 80");
        } else if (document.getElementById("map_se").checked) {
           e.setAttribute("viewBox", "290 179 310 100");
        } else if (document.getElementById("map_sc").checked) {
           e.setAttribute("viewBox", "155 190 290 100");
        } else if (document.getElementById("map_hi").checked) {
           e.setAttribute("viewBox", "0 190 290 140");
        }
      }

      var first_flag = 1;
      var svg_title = [];
      function OBJECT(D){
        try {S=D.getSVGDocument()}
        catch(e){S=D.contentDocument}
        return S
      }
      function fill_color(S, d) {
        for (var k in percent) {
           try { 
              e = S.getElementById(k)
              var p = percent[k][d]
              var color;
              if (p > 0) {
                 color = 'hsl(0, 100%,' + p.toString()+'%)';
              } else {
                 color = "#d0d0d0";
              }
              e.setAttributeNS(null, 'fill', color);
              if (first_flag == 1) {
                 svg_title[k] = e.children[0].innerHTML;
              }
              var title_case = svg_title[k] + '\n' + fips_cases[k][d].toString()
              //var title_id = e.children[0].id
              //e.innerHTML = "\n   <title xmlns=\"http://www.w3.org/2000/svg\" id=\"" + title_id + "\">" + title_case + "</title>\n  "
              e.innerHTML = "\n   <title xmlns=\"http://www.w3.org/2000/svg\">" + title_case + "</title>\n  "
           }
           catch(e){ continue; }
        }
        first_flag = 0;
      }
      function update_map(id) {
        var D=document.getElementById(id)
	S=eval(D.nodeName)(D,id) //sends OBJECT to function OBJECT, EMBED to EMBED etc.
	if (!S) return

        var slider = document.getElementById("myRange");
        var day = parseInt(slider.value);

        var slide_value = document.getElementById("myValue");
        slide_value.innerHTML = day_slide[day]

        var state = document.getElementById("choose-state").value
        var last_found = -1
        for (var k in county_rank[state]) {
           for (var i = 0; i < 10; i++) {
              if (county_rank[state][k][day] == i) {
                 document.getElementById("top_name["+i.toString()+"]").innerHTML  = k
                 var delta_str = ''
                 if (day > 0) {
                    var delta = county_cases[state][k][day] - county_cases[state][k][day-1]
                    if (delta >= 0) {
                       delta_str = "<font size='2'><br>(+"+delta.toString()+")</font>"
                    } else {
                       delta_str = "<font size='2'><br>("+delta.toString()+")</font>"
                    }
                 }
                 document.getElementById("top_value["+i.toString()+"]").innerHTML = county_cases[state][k][day] + delta_str
                 if (i > last_found) {
                    last_found = i;
                 }
              }
           }
        }
        for (var i = last_found + 1; i < 10; i++) {
           document.getElementById("top_name["+i.toString()+"]").innerHTML  = '-'
           document.getElementById("top_value["+i.toString()+"]").innerHTML = '-'
        }
        fill_color(S, day);
      }
    </script>

<div id="d01">
    <output class="lblFloat"><label>Date: <span id="myValue"></span></label></output>
    <input type="range" id="myRange" min="0" max="100" oninput="update_map('svg-object')" />
</div>

<div>
<select id="choose-state" oninput=update_map('svg-object')>
</select>
</div>
<script>
   function add_element(state) {
      var option = document.createElement('option');
      option.text = state
      option.value = state
      document.querySelector('#choose-state').add(option, null);
   }
   for (var i = 0; i < num_state; i++) {
      add_element(state_name[i])
   }
</script>


<div>
<font size="3" >
<table id="t01">
  <tr>
  <script>
  for (var i = 0; i < 5; i++) {
     document.writeln('<col width="100px" />')
     document.writeln('<col width="70px" />')
  }
  for (var i = 0; i < 5; i++) {
     document.writeln('<td align="center"><span id="top_name[' + i.toString() + ']">-</span></td>')
     document.writeln('<td align="center"><span id="top_value[' + i.toString() + ']">-</span></td>')
  }
  </script>
  </tr>
  <tr>
  <script>
  for (var i = 5; i < 10; i++) {
     document.writeln('<td align="center"><span id="top_name[' + i.toString() + ']">-</span></td>')
     document.writeln('<td align="center"><span id="top_value[' + i.toString() + ']">-</span></td>')
  }
  </script>
  </tr>
</table>
</div>

<script>
var slider = document.getElementById("myRange");
slider.max = (num_case-1).toString();
slider.value = (num_case/2).toString();
</script>

<div>
<br>
<p> SOURCES:<br>
1) <a href="https://github.com/CSSEGISandData/COVID-19">CSSEGISandData/COVID-19<br></a>
2) <a href="https://commons.wikimedia.org/wiki/File:USA_Counties.svg">File:USA Counties.svg</a>
</p>
</div>

</body>
</html>
